{% extends 'base.html' %}

{% block title %}{{ snippet.title }}{% endblock %}

{% block content %}
<h1>{{ snippet.title }}</h1>
<p><strong>Category:</strong> {{ snippet.category }}</p>
<p><strong>Technology:</strong> {{ snippet.technology }}</p>
<pre>{{ snippet.code }}</pre>

{% if user.is_authenticated %}
    <form method="POST" action="{% url 'vote_snippet' pk=snippet.pk %}">
        {% csrf_token %}
        <p>{{ snippet.get_upvotes }}</p>
        <button type="submit" name="vote" value="1">Upvote</button>
        <p>{{ snippet.get_downvotes }}</p>
        <button type="submit" name="vote" value="-1">Downvote</button>
    </form>

    {% if user == snippet.author or user.is_superuser %}
        <form method="POST" action="{% url 'snippet_delete' pk=snippet.pk %}">
            {% csrf_token %}
            <button type="submit" name="delete">Delete</button>
        </form>
        <a href="{% url 'snippet_edit' pk=snippet.pk %}">Edit</a>
    {% endif %}
{% endif %}


<h1>Comments</h1>
{% if comments %}
<ul>
    {% for comment in comments %}
    <li>{{ comment.content }} - {{ comment.author }} - {{ comment.created_at }}</li>
        {% if user.is_authenticated %}
            <form method="POST" action="{% url 'vote_comment' pk=comment.pk %}">
                {% csrf_token %}
                <p>{{ comment.get_upvotes }}</p>
                <button type="submit" name="vote" value="1">Upvote</button>
                <p>{{ comment.get_downvotes}}</p>
                <button type="submit" name="vote" value="-1">Downvote</button>
            </form>

            {% if user == comment.author or user.is_superuser %}
                <form method="POST" action="{% url 'comment_delete' pk=comment.pk %}">
                    {% csrf_token %}
                    <button type="submit" name="delete">Delete</button>
                </form>
            {% endif %}
        {% endif %}
    {% endfor %}
</ul>
{% else %}
<p>No comments yet.</p>
{% endif %}

<h2>Add Comment</h2>
{% if user.is_authenticated %}
<form method="POST">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button type="submit">Submit</button>
</form>
{% else %}
<p>You must be logged to add comment!</p>
{% endif %}

{% endblock %}